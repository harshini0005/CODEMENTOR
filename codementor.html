<!doctype html>
<html>
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>CodeMentor</title>
<script src="https://cdn.tailwindcss.com"></script>
<style>
  body{background:#0a0f1c;color:white;font-family:Inter,sans-serif;margin:0}
  .glass{backdrop-filter:blur(12px);background:rgba(255,255,255,0.04);border:1px solid rgba(255,255,255,0.06)}
  #matrixCanvas{position:fixed;top:0;left:0;width:100%;height:100%;z-index:-1}
  .hidden{display:none}
  .small{font-size:.85rem}
  textarea{resize:vertical}
</style>
</head>
<body>

<!-- LOGIN SCREEN -->
<div id="loginScreen" class="fixed inset-0 flex items-center justify-center z-50 text-white">
  <canvas id="matrixCanvas"></canvas>
  <div class="glass p-6 rounded-xl w-96 text-center space-y-4 z-10">
    <h1 class="text-2xl font-extrabold text-orange-400">CodeMentor</h1>
    <p>Learn ‚Ä¢ Practice ‚Ä¢ Track ‚Ä¢ Excel</p>

    <div id="selectType" class="space-x-2">
      <button id="btnUser" class="bg-orange-500 px-4 py-2 rounded">User Login</button>
      <button id="btnAdmin" class="bg-gray-700 px-4 py-2 rounded">Admin Login</button>
    </div>

    <div id="loginBox" class="mt-4"></div>
    <p id="loginMsg" class="text-red-400 text-sm"></p>
  </div>
</div>

<!-- APP ROOT -->
<div id="appRoot" class="hidden h-screen flex">
  <!-- Sidebar -->
  <aside class="w-56 glass p-5 space-y-4">
    <h2 class="font-bold text-lg">CodeMentor</h2>
    <button id="btnDashboard" onclick="showPage('dashboard')" class="block w-full text-left">üè† Dashboard</button>
    <button id="btnCompiler" onclick="showPage('compiler')" class="block w-full text-left">üßÆ Compiler</button>
    <button id="btnSkillTest" onclick="showPage('skillTest')" class="block w-full text-left">üß† Skill Test</button>
    <button id="adminBtn" onclick="showPage('admin')" class="hidden block w-full text-left">üõ† Admin Panel</button>
    <button id="logoutBtn" class="text-red-400">üö™ Logout</button>
  </aside>

  <!-- Pages -->
  <main class="flex-1 p-6 space-y-6 overflow-y-auto">

    <div id="dashboard" class="page">
      <h1 id="welcomeTitle" class="text-2xl font-bold">Welcome!</h1>
      <p id="introText" class="text-gray-300">Use the sidebar to navigate. Click <strong>Compiler</strong> to run Python in-browser.</p>
      <div id="resultBox" class="mt-4"></div>
    </div>

    <div id="compiler" class="page hidden glass p-4 rounded-xl">
      <h2 class="text-lg font-bold mb-2">Python Compiler</h2>
      <button id="loadPy" class="bg-orange-500 px-3 py-1 rounded">Load Python</button>
      <span id="runtimeState" class="text-sm ml-2">Not Loaded</span>
      <textarea id="code" class="w-full h-48 bg-black/60 text-white p-2 rounded mt-3">print("Hello CodeMentor")</textarea>
      <div class="mt-2 flex gap-2">
        <button id="run" class="bg-green-600 px-3 py-1 rounded">Run ‚ñ∂</button>
        <button id="clear" class="bg-gray-600 px-3 py-1 rounded">Clear</button>
      </div>
      <pre id="output" class="bg-black/80 p-2 mt-2 min-h-[120px] rounded"></pre>
    </div>

    <div id="skillTest" class="page hidden glass p-4 rounded-xl">
      <h2 class="text-xl font-bold mb-2">Python Skill Evaluation</h2>
      <p class="text-gray-300 mb-2">Select a topic then start the test (modal). Questions come only from the chosen topic.</p>
      <label class="block mb-1">Choose topic</label>
      <select id="topicSelect" class="w-full p-2 rounded bg-black/40 mb-3">
        <option value="variables">Variables & Data Types</option>
        <option value="loops">Loops & Conditions</option>
        <option value="functions">Functions</option>
        <option value="datastructures">Data Structures</option>
        <option value="oop">Object-Oriented Programming</option>
        <option value="filehandling">File Handling</option>
        <option value="exceptions">Exception Handling</option>
      </select>
      <button id="startTestBtn" class="bg-orange-500 px-4 py-2 rounded w-full">Start Test (Modal)</button>
      <p id="testMsg" class="text-red-400 text-sm mt-2"></p>
    </div>

    <div id="admin" class="page hidden glass p-4 rounded-xl">
      <h2 class="text-xl font-bold">Admin Panel</h2>
      <p class="text-gray-300 mb-2">Upload notes/tests/quizzes (demo local storage)</p>
      <input type="file" id="adminFile" class="mb-2" />
      <select id="adminType" class="mb-2 w-full p-2 rounded bg-black/10 text-white">
        <option value="notes">Notes</option>
        <option value="tests">Tests</option>
        <option value="quizzes">Quizzes</option>
      </select>
      <input id="adminTitle" placeholder="Title (optional)" class="w-full p-2 rounded bg-black/10 text-white mb-2" />
      <button id="adminUpload" class="bg-orange-500 px-3 py-2 rounded">Upload</button>
      <hr class="my-3" />
      <h3 class="font-semibold">Uploaded (demo)</h3>
      <div id="adminList" class="mt-2 space-y-2"></div>
    </div>

  </main>
</div>

<!-- Exam Modal -->
<div id="examModal" class="fixed inset-0 bg-black/80 hidden z-60 flex items-center justify-center">
  <div class="glass p-6 rounded-xl w-[90%] h-[90%] relative text-white overflow-y-auto">
    <h2 class="text-xl font-bold mb-2">Python Skill Test</h2>
    <p id="examTimer" class="text-red-400 font-bold mb-3 text-sm">Time Left: 30:00</p>
    <div id="examContent"></div>
    <div class="mt-4 flex gap-2">
      <button id="submitExam" class="bg-green-600 px-3 py-2 rounded">Submit</button>
      <button id="cancelExam" class="bg-red-600 px-3 py-2 rounded">Exit</button>
    </div>
  </div>
</div>

<script>
// Safe, cleaned JS ‚Äî all string templates escaped and balanced
window.addEventListener('DOMContentLoaded', ()=>{
  // Matrix effect
  const canvas = document.getElementById('matrixCanvas');
  const ctx = canvas.getContext('2d');
  function resize(){ canvas.width = innerWidth; canvas.height = innerHeight; }
  resize(); window.addEventListener('resize', resize);
  const chars = '0123456789ABCDEF'.split('');
  const fontSize = 14; let columns = Math.max(10, Math.floor(innerWidth / fontSize));
  let drops = new Array(columns).fill(1);
  setInterval(()=>{
    ctx.fillStyle = 'rgba(10,15,28,0.12)'; ctx.fillRect(0,0,canvas.width,canvas.height);
    ctx.fillStyle = '#ffa366'; ctx.font = fontSize + 'px monospace';
    for(let i=0;i<drops.length;i++){
      const txt = chars[Math.floor(Math.random()*chars.length)];
      ctx.fillText(txt, i*fontSize, drops[i]*fontSize);
      if(drops[i]*fontSize > canvas.height && Math.random()>0.95) drops[i]=0;
      drops[i]++;
    }
  },40);

  // Elements
  const selectType = document.getElementById('selectType');
  const loginBox = document.getElementById('loginBox');
  const loginMsg = document.getElementById('loginMsg');
  const btnUser = document.getElementById('btnUser');
  const btnAdmin = document.getElementById('btnAdmin');
  const logoutBtn = document.getElementById('logoutBtn');
  const adminBtn = document.getElementById('adminBtn');
  const startTestBtn = document.getElementById('startTestBtn');
  const examModal = document.getElementById('examModal');
  const examContent = document.getElementById('examContent');
  const examTimer = document.getElementById('examTimer');
  const submitExam = document.getElementById('submitExam');
  const cancelExam = document.getElementById('cancelExam');

  // storage helpers
  function loadUsers(){ try{ return JSON.parse(localStorage.getItem('users')||'[]'); }catch(e){return [];} }
  function saveUsers(u){ localStorage.setItem('users', JSON.stringify(u)); }

  // initial render
  function renderInitial(){ selectType.classList.remove('hidden'); loginBox.innerHTML=''; loginMsg.textContent=''; }
  renderInitial();

  // Render user login (hides admin)
  btnUser.addEventListener('click', ()=>{
    selectType.classList.add('hidden'); renderUserLogin();
  });

  // Render admin login (hides user)
  btnAdmin.addEventListener('click', ()=>{
    selectType.classList.add('hidden'); renderAdminLogin();
  });

  function renderUserLogin(){
    const users = loadUsers();
    loginBox.innerHTML = `
      <input id="u" placeholder="Username" class="p-2 w-full bg-black/40 rounded mb-2" />
      <input id="p" type="password" placeholder="Password" class="p-2 w-full bg-black/40 rounded mb-2" />
      <div class="flex gap-2">
        <button id="doUser" class="bg-orange-500 w-full py-2 rounded">Login</button>
        <button id="goSignup" class="bg-gray-600 w-full py-2 rounded">Sign Up</button>
      </div>
      <div id="saved" class="mt-2 text-left small"></div>
    `;
    document.getElementById('doUser').onclick = userLogin;
    document.getElementById('goSignup').onclick = renderSignup;

    const saved = document.getElementById('saved');
    if(users.length===0){ saved.innerHTML = '<div class="text-gray-400">No saved accounts</div>'; }
    else{
      saved.innerHTML = '<div class="text-gray-300 mb-1">Saved accounts:</div>' + users.map(u=>`<button class="w-full text-left p-1 rounded bg-black/30 mb-1" data-user="${u.username}">${u.username} ‚Ä¢‚Ä¢‚Ä¢‚Ä¢</button>`).join('');
      saved.querySelectorAll('button').forEach(b=>{
        b.addEventListener('click', ()=>{
          const uname = b.getAttribute('data-user');
          const users = loadUsers(); const acc = users.find(x=>x.username===uname);
          if(acc){ document.getElementById('u').value = acc.username; document.getElementById('p').value = acc.password; }
        });
      });
    }
  }

  function renderSignup(){
    loginBox.innerHTML = `
      <input id="name" placeholder="Full Name" class="p-2 w-full bg-black/40 rounded mb-2" />
      <input id="dob" type="date" class="p-2 w-full bg-black/40 rounded mb-2" />
      <input id="uname" placeholder="Username" class="p-2 w-full bg-black/40 rounded mb-2" />
      <input id="pass" type="password" placeholder="Password" class="p-2 w-full bg-black/40 rounded mb-2" />
      <input id="cpass" type="password" placeholder="Confirm Password" class="p-2 w-full bg-black/40 rounded mb-2" />
      <button id="createAcc" class="bg-orange-500 w-full py-2 rounded">Create Account</button>
    `;
    document.getElementById('createAcc').onclick = signup;
  }

  function renderAdminLogin(){
    loginBox.innerHTML = `
      <input id="au" placeholder="Admin Username" class="p-2 w-full bg-black/40 rounded mb-2" />
      <input id="ap" type="password" placeholder="Password" class="p-2 w-full bg-black/40 rounded mb-2" />
      <button id="doAdmin" class="bg-gray-600 w-full py-2 rounded">Admin Login</button>
    `;
    document.getElementById('doAdmin').onclick = adminLogin;
  }

  // Signup handler
  function signup(){
    loginMsg.textContent='';
    const name = document.getElementById('name').value.trim();
    const dob = document.getElementById('dob').value;
    const uname = document.getElementById('uname').value.trim();
    const pass = document.getElementById('pass').value;
    const cpass = document.getElementById('cpass').value;
    if(!name || !uname || !pass){ loginMsg.textContent = 'Fill required fields'; return; }
    if(pass !== cpass){ loginMsg.textContent = 'Passwords do not match'; return; }
    const users = loadUsers();
    if(users.find(u=>u.username===uname)){ loginMsg.textContent='Username already exists'; return; }
    users.push({name,dob,username:uname,password:pass,history:[]});
    saveUsers(users);
    loginMsg.textContent = 'Account created ‚Äî you can login now';
    renderUserLogin();
  }

  // Login handlers
  function userLogin(){
    loginMsg.textContent='';
    const u = document.getElementById('u').value.trim();
    const p = document.getElementById('p').value;
    if(!u||!p){ loginMsg.textContent='Enter credentials'; return; }
    const users = loadUsers();

    // VIP auto-detect
    if(u==='sai' && p==='1042'){
      const vipUser = {name:'Sai', username:'sai', VIP:true};
      sessionStorage.setItem('role','user');
      sessionStorage.setItem('user',JSON.stringify(vipUser));
      sessionStorage.setItem('VIP','true');
      startApp();
      return;
    }

    const acc = users.find(x=>x.username===u && x.password===p);
    if(!acc){ loginMsg.textContent='Invalid username or password'; return; }
    acc.VIP = false;
    sessionStorage.setItem('role','user');
    sessionStorage.setItem('user',JSON.stringify(acc));
    sessionStorage.removeItem('VIP');
    startApp();
  }

  function adminLogin(){
    loginMsg.textContent='';
    const u = document.getElementById('au').value.trim();
    const p = document.getElementById('ap').value.trim();
    if(u==='Codementor' && p==='174254'){
      sessionStorage.setItem('role','admin');
      sessionStorage.setItem('user',JSON.stringify({name:'Admin',username:'Codementor'}));
      startApp();
    } else {
      loginMsg.textContent='Wrong admin credentials';
    }
  }

  // Start app after login
  function startApp(){
    document.getElementById('loginScreen').classList.add('hidden');
    document.getElementById('appRoot').classList.remove('hidden');
    const raw = sessionStorage.getItem('user');
    if(raw){ const u = JSON.parse(raw); document.getElementById('welcomeTitle').textContent = `Welcome, ${u.name||u.username}!`; }
    if(sessionStorage.getItem('role')==='admin') adminBtn.classList.remove('hidden'); else adminBtn.classList.add('hidden');
    renderProfile();
    // Onboarding intro
    const intro = document.getElementById('introText');
    intro.innerHTML = `Welcome to CodeMentor üöÄ<br>Use the menu on the left to explore tools.<br>Start with the <b>Compiler</b> to run Python instantly!`;
    setTimeout(()=>{ intro.innerHTML += `<br><br>üëá Ready to grow your skills? Try the <b>Skill Test</b>.`; },2000);
  }

  // render profile & history chart area
  function renderProfile(){
    const raw = sessionStorage.getItem('user'); if(!raw) return; const u = JSON.parse(raw);
    const box = document.getElementById('resultBox'); box.innerHTML = '';
    const h = document.createElement('div'); h.className='glass p-3 rounded'; h.innerHTML = `<b>Username:</b> ${u.username} <br/><b>Name:</b> ${u.name||'-'}`;
    box.appendChild(h);
    // chart placeholder - actual chart builds when we add history
  }

  // logout
  logoutBtn.addEventListener('click', ()=>{ sessionStorage.clear(); renderInitial(); document.getElementById('loginScreen').classList.remove('hidden'); document.getElementById('appRoot').classList.add('hidden'); });

  // navigation
  window.showPage = function(id){ document.querySelectorAll('.page').forEach(p=>p.classList.add('hidden')); const el=document.getElementById(id); if(el) el.classList.remove('hidden'); }
  document.getElementById('btnDashboard').onclick = ()=> showPage('dashboard');
  document.getElementById('btnCompiler').onclick = ()=> showPage('compiler');
  document.getElementById('btnSkillTest').onclick = ()=> showPage('skillTest');

  // Admin uploads (demo)
  document.getElementById('adminUpload')?.addEventListener('click', ()=>{
    const f = document.getElementById('adminFile').files[0]; const t = document.getElementById('adminType').value; const title = document.getElementById('adminTitle').value || (f && f.name) || '';
    if(!f){ alert('Choose file'); return; }
    const reader=new FileReader(); reader.onload = (e)=>{ const blob=new Blob([e.target.result]); const url=URL.createObjectURL(blob); const list = JSON.parse(localStorage.getItem(t)||'[]'); list.unshift({title,name:f.name,url,date:new Date().toISOString()}); localStorage.setItem(t,JSON.stringify(list)); renderAdminList(); alert('Uploaded (demo)'); }; reader.readAsArrayBuffer(f);
  });
  function renderAdminList(){ const list=document.getElementById('adminList'); if(!list) return; list.innerHTML=''; ['notes','tests','quizzes'].forEach(k=>{ const items=JSON.parse(localStorage.getItem(k)||'[]'); if(items.length){ const h=document.createElement('div'); h.innerHTML=`<b>${k}</b>`; list.appendChild(h); items.forEach(it=>{ const d=document.createElement('div'); d.innerHTML=`<span>${it.title||it.name}</span> <a href='${it.url}' target='_blank' class='text-orange-300 ml-2'>View</a>`; list.appendChild(d); }); } }); }
  renderAdminList();

  // Exam modal open
  document.getElementById('startTestBtn')?.addEventListener('click', ()=>{
    // ensure user logged in
    if(!sessionStorage.getItem('role')){ alert('Login as user to take test'); return; }
    examModal.classList.remove('hidden');
    // build simple exam UI
    const topic = document.getElementById('topicSelect').value;
    examContent.innerHTML = '\n      <p class=\'font-bold\'>Descriptive (50 words): Explain '+topic+' with example</p>\n      <textarea id=\'ansDesc\' class=\'w-full h-24 p-2 bg-black/40 rounded mb-2\'></textarea>\n      <p class=\'font-bold\'>Coding: provide body of <code>def solve(n):</code></p>\n      <textarea id=\'ansCode\' class=\'w-full h-36 p-2 bg-black/40 rounded mb-2\'>def solve(n):\n    pass</textarea>\n    ';

    // VIP ghost typing setup
    const user = JSON.parse(sessionStorage.getItem('user')||'{}');
    const isVIP = user && user.VIP;
    const sampleAnswer = isVIP ? '# VIP Guidance\ndef solve(n):\n    # example: return n*n for square\n    return n*n' : '';
    if(isVIP){
      const codeArea = document.getElementById('ansCode');
      // attach ghost as placeholder behavior
      codeArea.dataset.ghost = sampleAnswer;
      codeArea.style.opacity = '1';
      codeArea.addEventListener('input', ()=>{
        const ghost = codeArea.dataset.ghost || '';
        const typed = codeArea.value || '';
        if(ghost.startsWith(typed)){
          const remain = ghost.slice(typed.length);
          codeArea.placeholder = remain;
        } else {
          codeArea.dataset.ghost = '';
          codeArea.placeholder = '';
        }
      });
    }

    // start timer 30 min
    let timeLeft=1800; examTimer.textContent = 'Time Left: 30:00';
    const id = setInterval(()=>{ timeLeft--; if(timeLeft<=0){ clearInterval(id); submitExam.click(); } const m=Math.floor(timeLeft/60), s=timeLeft%60; examTimer.textContent = `Time Left: ${m}:${String(s).padStart(2,'0')}`; },1000);
    cancelExam.onclick = ()=>{ if(confirm('Exit test?')){ clearInterval(id); examModal.classList.add('hidden'); } };
    submitExam.onclick = ()=>{ clearInterval(id); examModal.classList.add('hidden'); alert('Submitted (demo)'); };
  });

  // anti-cheat basics: block ctrl+c/v while exam active - simple demo
  let examActive=false;
  const VIP = sessionStorage.getItem('VIP')==='true';

  document.addEventListener('copy', e=>{ if(examActive && !VIP) e.preventDefault(); });
  document.addEventListener('paste', e=>{ if(examActive && !VIP) e.preventDefault(); });
  window.addEventListener('blur', ()=>{ if(examActive && !VIP) { alert('‚ö†Ô∏è Do not switch tabs during the exam.'); } });

  // Pyodide loader + compiler
  let py=null, loaded=false;
  document.getElementById('loadPy').addEventListener('click', ()=>{ if(loaded) return; document.getElementById('runtimeState').textContent='Loading...'; const s=document.createElement('script'); s.src='https://cdn.jsdelivr.net/pyodide/v0.24.0/full/pyodide.js'; s.onload=async()=>{ py = await loadPyodide({indexURL:'https://cdn.jsdelivr.net/pyodide/v0.24.0/full/'}); loaded=true; document.getElementById('runtimeState').textContent='Ready ‚úÖ'; }; document.head.appendChild(s); });
  document.getElementById('run').addEventListener('click', async ()=>{ if(!loaded){ alert('Load Python Runtime first'); return; } const code = document.getElementById('code').value; try{ let result = await py.runPythonAsync('\nimport io, sys\nsys.stdout = io.StringIO()\n' + code + '\nsys.stdout.getvalue()'); document.getElementById('output').textContent = result; }catch(e){ document.getElementById('output').textContent = String(e); } });
  document.getElementById('clear').addEventListener('click', ()=>{ document.getElementById('output').textContent=''; });

}); // end DOMContentLoaded
</script>
</body>
</html>
